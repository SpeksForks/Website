<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="">
    <link rel="stylesheet" href="/assets/css/app.css">
    <title>Orchid - PHP платформа - Socket</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic&subset=latin,cyrillic'
          rel='stylesheet' type='text/css'>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ac5ca0">
    <meta name="theme-color" content="#ffffff">

</head>


<body>


<header id="header" class="navbar bg-white-only box-shadow-lg">
    <div class="container">
        <div class="navbar-header">
            <a href="/" class="brand navbar-brand">
                <img src="/assets/img/orchid.svg" width="150px">
            </a>
        </div>
    </div>
</header>




    <div class="container padder-v">
        <div class="row">

            <div class="col-md-3">
                <nav>
    <h4 class="text-orchid font-thin">Как начать</h4>
    <ul class="toc-links">
        <li><a href="/docs/">Главная</a></li>
        <li><a href="/docs/installation/">Установка</a></li>
        <li><s>Обновление</s></li>
        <li><a href="/docs/roudmap/">Дорожная карта</a></li>
    </ul>


    <h4 class="text-orchid font-thin">Приложение</h4>
    <ul class="toc-links">
        <li><s href="/docs/installation/">Post</s></li>
        <li><s href="/docs/installation/">Fields</s></li>
        <li><s href="/docs/installation/">Types</s></li>
        <li><s href="/docs/installation/">Category</s></li>
    </ul>

    <h4 class="text-orchid font-thin">Основы</h4>
    <ul class="toc-links">
        <li><a href="/docs/access/">Права доступа</a></li>
        <li><s href="/docs/logs/"><a>Журнал</a></s></li>
        <li><a href="/docs/widget/">Виджеты</a></li>
        <li><a href="/docs/settings/">Настройки</a></li>
        <li><a href="/docs/extends/">Расширение</a></li>
        <li><a href="/docs/alert/">Уведомления</a></li>
        <li><a href="/docs/active/">Активные ссылки</a></li>
        <li><a href="/docs/tags/">Тегирование</a></li>
        <li><s href="/docs/installation/">Локализация</s></li>
    </ul>



    <h4 class="text-orchid font-thin">Пакеты</h4>
    <ul class="toc-links">
        <li><a href="/docs/socket/">Веб-сокет</a></li>
    </ul>


    <h4 class="text-orchid font-thin">Участиве в проекте</h4>
    <ul class="toc-links">
        <li><a href="/blog/">Блог</a></li>
        <li><a href="/docs/contributors/">Участие в разработке</a></li>
        <li><a href="/docs/license/">Лицензия</a></li>
    </ul>
</nav>            </div>

            <div class="col-md-9 panel b box-shadow-lg wrapper-lg">

                <main>
                                <p></p>
<h1>Socket</h1>
<hr />
<p>WebSocket — протокол полнодуплексной связи поверх TCP-соединения, предназначенный для обмена сообщениями между браузером и веб-сервером в режиме реального времени.</p>
<p>WebSocket разработан для воплощения в web-браузерах и web-серверах, но он может быть использован для любого клиентского или серверного приложения. </p>
<p>Протокол WebSocket - это независимый протокол, основанный на протоколе TCP. Он делает возможным более тесное взаимодействие между браузером и web сайтом, способствуя распространению интерактивного содержимого и созданию игр реального времени.</p>
<h3>Создание :</h3>
<p>Чтобы создать новый виджет, необходимо выполнить</p>
<pre><code class="language-php">php artisan make:socket MyNameClass</code></pre>
<p>В папке <code>app/HTTP/Socket/Listener</code> создаться шаблон веб-сокета.</p>
<p>После создания необходимо установить маршрут который распологается <code>app/HTTP/Socket/routes.php</code></p>
<pre><code class="language-php">//Основу маршрутизации составляет Symfony Routing Component
$socket-&gt;route('/myclass', new MyClass, ['*']);</code></pre>
<p>Для запуска веб-сокета используйте команду:</p>
<pre><code class="language-php">php artisan socket:serve</code></pre>
<h3>Частые вопросы</h3>
<p>Пример установки уникальных номеров сокета и сессии laravel</p>
<pre><code class="language-php">
    public function onOpen(ConnectionInterface $conn)
    {
        $this-&gt;clients-&gt;attach($conn);

        //Берем user id
        $userId = $this-&gt;getUserFromSession($conn);

        //Создаем список юзеров подключенных к серверу
        array_push($this-&gt;userList, $userId);

        //Рассказываем всё что произошло
        echo "New connection! user_id = ({$userId})\n";
    }

    public function getUserFromSession($conn)
    {
        // Create a new session handler for this client
        $session = (new SessionManager(App::getInstance()))-&gt;driver();

        // Get the cookies
        $cookies = $conn-&gt;WebSocket-&gt;request-&gt;getCookies();

        // Get the laravel's one
        $laravelCookie = urldecode($cookies[Config::get('session.cookie')]);

        // get the user session id from it
        $idSession = Crypt::decrypt($laravelCookie);

        // Set the session id to the session handler
        $session-&gt;setId($idSession);

        // Bind the session handler to the client connection
        $conn-&gt;session = $session;
        $conn-&gt;session-&gt;start();

        //Берем юзера из сессии
        $userId = $conn-&gt;session-&gt;get(Auth::getName());
        return $userId;
    }
</code></pre>
<p>Подключение веб-сокета на JavaScript</p>
<pre><code class="language-javascript">var socket = new WebSocket("ws://localhost");

socket.onopen = function() {
  alert("Соединение установлено.");
};

socket.onclose = function(event) {
  if (event.wasClean) {
    alert('Соединение закрыто чисто');
  } else {
    alert('Обрыв соединения'); // например, "убит" процесс сервера
  }
  alert('Код: ' + event.code + ' причина: ' + event.reason);
};

socket.onmessage = function(event) {
  alert("Получены данные " + event.data);
};

socket.onerror = function(error) {
  alert("Ошибка " + error.message);
};

Для посылки данных используется метод socket.send(data). Пересылать можно любые данные.

Например, строку:
socket.send("Привет");
</code></pre>
<p></p>
                            </main>

            </div>
        </div>
    </div>





<footer id="footer">
    <div class="bg-white b-t">
        <div class="container padder-v">


            <div class="row">

                <div class="col-md-6 col-md-offset-6">
                    <div class="pull-right text-right">
                        <span class="text-md block">The Orchid</span>
                        <small>Код приложения опубликован под лицензией MIT</small>
                    </div>
                </div>
            </div>


        </div>
    </div>
</footer>



<script src="/assets/js/app.js"></script>
</body>
</html>
